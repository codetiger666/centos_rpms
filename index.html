<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ªç¼–è¯‘è½¯ä»¶ä»“åº“</title>
    <style>
        /* å–æ¶ˆç§»åŠ¨ç«¯ç‚¹å‡»èƒŒæ™¯æ•ˆæœ */
        * {
            -webkit-tap-highlight-color: transparent;
        }

        .folder {
            font-weight: bold;
            cursor: pointer;
        }
        .folder::before {
            content: "ğŸ“ ";
        }
        .file::before {
            content: "ğŸ“„ ";
        }
        .nested {
            margin-left: 5px; /* ç¼©å°ç¼©è¿›å€¼ */
            opacity: 0; /* åˆå§‹é€æ˜åº¦ä¸º 0 */
            transform: scaleY(0); /* åˆå§‹é«˜åº¦ä¸º 0 */
            transform-origin: top; /* ä»é¡¶éƒ¨å¼€å§‹ç¼©æ”¾ */
            transition: opacity 0.3s ease, transform 0.3s ease; /* æ·»åŠ è¿‡æ¸¡æ•ˆæœ */
            max-height: 0; /* åˆå§‹é«˜åº¦ä¸º 0 */
            /*overflow: hidden; /* éšè—æº¢å‡ºå†…å®¹ */*/
        }
        .nested.active {
            opacity: 1; /* å®Œå…¨æ˜¾ç¤º */
            transform: scaleY(1); /* æ¢å¤åŸå§‹é«˜åº¦ */
            max-height: 1000px; /* è®¾ç½®ä¸€ä¸ªè¶³å¤Ÿå¤§çš„å€¼ */
        }
    </style>
</head>
<body>
    <h1>è‡ªç¼–è¯‘è½¯ä»¶ä»“åº“</h1>
    <ul id="fileList"></ul>

    <script>
        // GitHub API URL to list repository contents
        const repo = 'codetiger666/rpms'; // Replace with your username and repository name
        const branch = 'release'; // Replace with your branch name
        const apiUrl = `https://api.github.com/repos/${repo}/contents/`;

        // Fetch the list of files and folders from the repository
        fetch(apiUrl + "?ref=" + branch)
            .then(response => response.json())
            .then(data => {
                const fileList = document.getElementById('fileList');
                data.forEach(item => {
                    // Filter out 'index.html' and 'README.md'
                    if (item.name === 'index.html' || item.name === 'README.md') {
                        return;
                    }

                    const li = document.createElement('li');
                    if (item.type === 'dir') {
                        // If it's a folder
                        li.className = 'folder';
                        li.textContent = item.name;
                        li.addEventListener('click', (event) => {
                            event.preventDefault(); // é˜»æ­¢é»˜è®¤ç‚¹å‡»è¡Œä¸º
                            // Only toggle folder if the click is on the folder name itself
                            if (event.target === li) {
                                event.stopPropagation(); // Prevent click event from propagating to parent elements
                                toggleFolder(item.path, li);
                            }
                        });
                    } else {
                        // If it's a file
                        li.className = 'file';
                        const a = document.createElement('a');
                        a.href = `https://raw.githubusercontent.com/${repo}/${branch}/${item.path}`;
                        a.textContent = item.name;
                        a.download = item.name; // Add download attribute to trigger download
                        a.addEventListener('click', (event) => {
                            event.stopPropagation(); // Prevent click event from propagating to parent folder
                        });
                        li.appendChild(a);
                    }
                    fileList.appendChild(li);
                });
            })
            .catch(error => console.error('Error fetching files:', error));

        // Toggle folder expand/collapse
        function toggleFolder(path, parentElement) {
            const nestedList = parentElement.querySelector('.nested');
            if (nestedList) {
                nestedList.classList.toggle('active');
            } else {
                fetch(`https://api.github.com/repos/${repo}/contents/${path}?ref=${branch}`)
                    .then(response => response.json())
                    .then(data => {
                        const ul = document.createElement('ul');
                        ul.className = 'nested';
                        data.forEach(item => {
                            // Filter out 'index.html' and 'README.md'
                            if (item.name === 'index.html' || item.name === 'README.md') {
                                return;
                            }

                            const li = document.createElement('li');
                            if (item.type === 'dir') {
                                li.className = 'folder';
                                li.textContent = item.name;
                                li.addEventListener('click', (event) => {
                                    event.preventDefault(); // é˜»æ­¢é»˜è®¤ç‚¹å‡»è¡Œä¸º
                                    // Only toggle folder if the click is on the folder name itself
                                    if (event.target === li) {
                                        event.stopPropagation(); // Prevent click event from propagating to parent elements
                                        toggleFolder(item.path, li);
                                    }
                                });
                            } else {
                                li.className = 'file';
                                const a = document.createElement('a');
                                a.href = `https://raw.githubusercontent.com/${repo}/${branch}/${item.path}`;
                                a.textContent = item.name;
                                a.download = item.name; // Add download attribute to trigger download
                                a.addEventListener('click', (event) => {
                                    event.stopPropagation(); // Prevent click event from propagating to parent folder
                                });
                                li.appendChild(a);
                            }
                            ul.appendChild(li);
                        });
                        parentElement.appendChild(ul);
                        // å¼ºåˆ¶è§¦å‘é‡ç»˜ï¼Œç¡®ä¿åŠ¨ç”»ç”Ÿæ•ˆ
                        void ul.offsetHeight; // è§¦å‘é‡ç»˜
                        ul.classList.add('active'); // æ·»åŠ  active ç±»ä»¥è§¦å‘åŠ¨ç”»
                    })
                    .catch(error => console.error('Error fetching folder contents:', error));
            }
        }
    </script>
</body>
</html>
